<div align="center">

<h1>üåä AGOS</h1>
<p><strong>AI-Guided Overflow Surveillance ‚Äî IoT Module</strong></p>
<p>Edge Data Acquisition for Real-Time Waterway Blockage Detection and Flood Alerting<br/>using Raspberry Pi Zero W + Raspberry Pi Camera</p>

![Status](https://img.shields.io/badge/status-active-brightgreen)
![Python](https://img.shields.io/badge/python-3.9+-blue)
![Hardware](https://img.shields.io/badge/hardware-RPi%20Zero%20W-red)
![YOLOv8](https://img.shields.io/badge/AI-YOLOv8-purple)
![License](https://img.shields.io/badge/license-academic-orange)

</div>

---

> ‚ö†Ô∏è **This is the IoT hardware module repository** of the AGOS system.
> It handles edge data acquisition: camera capture, water level sensing, and data transmission to the backend server.
> See the [AGOS Ecosystem](#-part-of-the-agos-ecosystem) section for links to the other repositories.

---

## üìã Table of Contents

- [Part of the AGOS Ecosystem](#-part-of-the-agos-ecosystem)
- [Overview](#-overview)
- [Problem Statement](#-problem-statement)
- [Key Features](#-key-features)
- [Hardware Architecture](#Ô∏è-hardware-architecture)
- [Tech Stack](#Ô∏è-tech-stack)
- [Alert Tier Logic](#-alert-tier-logic)
- [User Roles & Access Control](#-user-roles--access-control)
- [End-to-End Data Flow](#-end-to-end-data-flow)
- [Scope & Limitations](#-scope--limitations)
- [GitHub Copilot Instructions](#-github-copilot-instructions)

---

## üîó Part of the AGOS Ecosystem

AGOS is split across three repositories. This repo covers the **IoT layer only**.

| Repository                                     | Description                                                                              |
| ---------------------------------------------- | ---------------------------------------------------------------------------------------- |
| `agos-iot-flood-monitoring` ‚Üê **you are here** | Raspberry Pi Zero W edge module ‚Äî camera capture, water level sensing, data transmission |
| `agos-backend`                                 | FastAPI server ‚Äî AI inference (YOLOv8), sensor fusion, alert engine, PostgreSQL          |
| `agos-frontend`                                | React + TypeScript dashboard ‚Äî live monitoring, alert logs, admin controls               |

---

## üåä Overview

**AGOS (AI-Guided Overflow Surveillance)** is an integrated flood monitoring and early warning system developed for **Barangay Maysan, Valenzuela City, Philippines**. It combines AI-powered computer vision, IoT sensor telemetry, and real-time weather data into a single decision engine that automatically detects drainage blockages and dispatches tiered SMS alerts to emergency responders ‚Äî before flooding occurs.

This repository contains the **edge IoT module**: a Raspberry Pi Zero W paired with a Raspberry Pi Camera that captures waterway footage and a JSN-SR04T ultrasonic sensor that measures water depth. This module transmits data to the AGOS backend server for AI processing, fusion logic, and alerting.

> üéì **Capstone Project** ‚Äî Bachelor of Science in Information Technology  
> Pamantasan ng Lungsod ng Valenzuela (PLV)  
> College of Engineering and Information Technology  
> 2026

---

## üß© Problem Statement

Urban flooding in dense Philippine communities is primarily caused not by rainfall volume alone, but by **physical obstructions in drainage systems** ‚Äî mostly plastic and solid waste. Current monitoring in Barangay Maysan relies on manual, hazardous field inspections that are delayed, inaccurate, and put barangay workers at risk during storms.

Key gaps AGOS addresses:

- ‚ùå Manual inspection requires personnel to physically check flood markers during dangerous weather
- ‚ùå Single-sensor systems (camera-only or ultrasonic-only) each fail under different environmental conditions
- ‚ùå No automated system exists to correlate visual blockage evidence with real water depth measurements
- ‚ùå LGU and Waste Management Division (WMD) lack proactive tools to dispatch cleanup crews before a flood occurs

---

## ‚ú® Key Features

- **Raspberry Pi Camera Capture** ‚Äî Captures waterway footage at 1 FPS and streams frames to the AGOS backend for YOLOv8 inference
- **IoT Water Level Sensing** ‚Äî JSN-SR04T waterproof ultrasonic sensor transmits water depth readings every 30 seconds via HTTPS POST
- **Lightweight Edge Design** ‚Äî Raspberry Pi Zero W keeps hardware costs low and power consumption minimal; no local AI inference required
- **Secure Data Transmission** ‚Äî All sensor and image data sent via HTTPS to the backend server
- **IP67 Weatherproof Enclosure** ‚Äî Electronics protected for outdoor tropical deployment
- **4G / WiFi Connectivity** ‚Äî Supports both SIM-based 4G and WiFi for flexible field deployment
- **Zero CCTV Hardware Modification** ‚Äî Designed as a standalone module; does not interfere with any existing LGU CCTV infrastructure

---

## üèóÔ∏è Hardware Architecture

This repo covers the **Drainage Site Layer** only. The backend and dashboard layers live in their respective repositories.

### Drainage Site Layer (This Repo)

| Component          | Details                                                                           |
| ------------------ | --------------------------------------------------------------------------------- |
| Edge Computer      | Raspberry Pi Zero W                                                               |
| Camera             | Raspberry Pi Camera Module (captures at 1 FPS; frames sent to backend)            |
| Water Level Sensor | JSN-SR04T waterproof ultrasonic sensor                                            |
| Connectivity       | 4G SIM module or WiFi                                                             |
| Enclosure          | IP67 waterproof housing                                                           |
| Power              | LGU-provided electrical supply                                                    |
| Data Output        | HTTPS POST to AGOS backend every 30 seconds (water level) + frame upload (camera) |

### How It Fits Into the Full System

```

[This Repo] Raspberry Pi Zero W
‚îú‚îÄ‚îÄ Pi Camera ‚Üí captures frame ‚Üí HTTPS POST ‚Üí agos-backend (YOLOv8 inference)
‚îî‚îÄ‚îÄ JSN-SR04T ‚Üí water level cm ‚Üí HTTPS POST ‚Üí agos-backend (sensor fusion)

[agos-backend] FastAPI Server
‚îú‚îÄ‚îÄ Runs YOLOv8, fusion logic, alert engine
‚îî‚îÄ‚îÄ Sends SMS via Semaphore API

[agos-frontend] React Dashboard
‚îî‚îÄ‚îÄ Displays live status, charts, admin controls

```

---

## üõ†Ô∏è Tech Stack

```

Edge Hardware: Raspberry Pi Zero W ¬∑ Raspberry Pi Camera Module
Sensor: JSN-SR04T Waterproof Ultrasonic Sensor
Language: Python 3.9+
Connectivity: 4G SIM Module ¬∑ WiFi (RPi built-in)
Libraries: Picamera2 ¬∑ RPi.GPIO ¬∑ requests
Protocol: HTTPS POST to AGOS Backend REST API
Enclosure: IP67 Weatherproof Housing

```

---

## üö® Alert Tier Logic

Alert tiers are **evaluated and triggered by the backend server** (`agos-backend`), not this module. This module's responsibility is accurate, timely data delivery. For reference:

| Tier       | Name          | Trigger Conditions                                                                                      | Action                            |
| ---------- | ------------- | ------------------------------------------------------------------------------------------------------- | --------------------------------- |
| **Tier 3** | üî¥ Critical   | Visual = `Blocked` (YOLO ‚â• 0.80 confidence) **AND** Water ‚â• 10 cm **AND** Weather = `heavy_rain`        | Immediate SMS ‚Äî bypasses cooldown |
| **Tier 2** | üü° Warning    | Visual = `Partial` or `Blocked` **AND** (water rising OR moderate rain) **AND** no alert in last 30 min | Auto-SMS with 30-min cooldown     |
| **Tier 1** | üü¢ Monitoring | Debris detected (low confidence) **AND** water stable **AND** weather clear                             | Log only ‚Äî no SMS                 |

> ‚è±Ô∏è **Anti-Spam Rule:** A 30-minute cooldown is enforced per alert tier after dispatch. Tier 3 overrides the cooldown when all critical conditions are simultaneously true.

---

## üë• User Roles & Access Control

User management and authentication are handled by the **`agos-backend`** and **`agos-frontend`** repositories. For reference:

### Super User

- Only **one (1) Super User** exists at any time; created via one-time seed script
- Full administrative access: create admins, reset passwords, transfer Super User role, deactivate any regular admin
- **Cannot deactivate themselves** ‚Äî must transfer role to another admin first

### Regular Admin

- Created by Super User with a temporary 12-character password
- Forced password change on first login (`force_password_change = TRUE`)
- Can: view dashboard, send manual alerts, manage responders, view logs, change own password
- Cannot: create new admins, reset other admins' passwords, or deactivate the Super User

### Responders

- Field personnel registered via phone number
- Receive automated and manual SMS alerts
- No dashboard access

**Authentication Flow:**

- Login: Phone number + password (not email)
- Session: JWT tokens
- Password Recovery: 6-digit OTP via SMS (10-minute expiry)
- Brute-force protection: 30-minute lockout after 5 failed OTP attempts

---

## üîÑ End-to-End Data Flow

```

[Raspberry Pi Camera] ‚Üí frame HTTPS POST / 1s ‚Üí [agos-backend: YOLOv8]
[JSN-SR04T Ultrasonic] ‚Üí water level HTTPS POST / 30s ‚Üí [agos-backend: sensor store]
[OpenWeatherMap API] ‚Üí polled by backend / 5 min ‚Üí [agos-backend: weather store]
‚Üì
[Fusion Decision Engine @ 1s]
‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Tier 1 ‚Üí Log Only (no SMS) ‚îÇ
‚îÇ Tier 2 ‚Üí Auto-SMS (30-min cooldown) ‚îÇ
‚îÇ Tier 3 ‚Üí Auto-SMS (immediate, no cooldown)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üì
[PostgreSQL] ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí [React Dashboard]
‚Üì
[Semaphore API ‚Üí Responder SMS]

```

---

## üìè Scope & Limitations

### In Scope (This Repo)

- Raspberry Pi Zero W edge device setup and configuration
- Raspberry Pi Camera frame capture at **1 FPS** and transmission to backend
- JSN-SR04T ultrasonic water level reading and HTTPS POST to backend every **30 seconds**
- 4G and WiFi connectivity management
- IP67 weatherproof enclosure design and wiring

### Out of Scope (This Repo)

- AI inference (YOLOv8) ‚Äî handled by `agos-backend`
- Alert logic, SMS dispatch, sensor fusion ‚Äî handled by `agos-backend`
- Web dashboard and user interface ‚Äî handled by `agos-frontend`
- Multi-site deployment (requires sensor recalibration per site)
- Long-term hardware maintenance beyond the validation period

### Known Limitations

- Raspberry Pi Camera accuracy degrades under torrential rain, dense fog, or extreme low-light conditions
- Requires stable 4G or WiFi connectivity at the deployment site
- Continuous operation depends on LGU-provided electrical power
- Pi Zero W has limited processing headroom ‚Äî do not add local inference tasks to this module

---

**Institution:** Pamantasan ng Lungsod ng Valenzuela
**Department:** College of Engineering & Information Technology ‚Äî IT Department
**Completion:** October 2026

---

## ü§ñ GitHub Copilot Instructions

> This section provides project context and rules for GitHub Copilot scoped to the **IoT module only** (`agos-iot-flood-monitoring`). For backend or frontend rules, refer to their respective repositories.

### Project Identity

This is the **edge hardware module** of AGOS ‚Äî an AI flood detection and early warning system for a Philippine LGU. This repo runs on a **Raspberry Pi Zero W** in a weatherproof outdoor enclosure at a drainage monitoring site. Code here must be lightweight, fault-tolerant, and optimized for a resource-constrained device. No heavy libraries, no local AI inference.

---

### Architecture Rules

- **Platform:** Raspberry Pi Zero W running Python 3.9+
- **Camera:** Use `Picamera2` for all camera operations ‚Äî do not use the legacy `picamera` library
- **Frame Rate:** Capture and transmit exactly **1 frame per second** to the backend ‚Äî do not increase this; it is intentional for resource efficiency and backend compatibility
- **Water Level Sensor:** Read from JSN-SR04T via GPIO using time-of-flight calculation. Transmit via `HTTPS POST` to the backend every **30 seconds**
- **Data Transmission:** All data sent to the `agos-backend` REST API via HTTPS. Use the `requests` library ‚Äî keep all outbound calls non-blocking with a timeout
- **No Local AI:** Do not add YOLOv8 or any ML inference to this module. All inference happens on the backend server
- **No Database:** This module does not have a local database. If a transmission fails, log the failure and retry on the next cycle ‚Äî do not queue indefinitely

---

### Coding Conventions

- **Python:** `snake_case` for all variables and functions
- All environment-sensitive values (backend URL, API key, sensor IDs) must be loaded from `.env` via `python-dotenv` ‚Äî **never hardcode credentials**
- Every outbound HTTPS POST must include a `sensor_id` field so the backend can identify which device is transmitting
- Every successful transmission must print a timestamped log line to stdout ‚Äî this is the primary debugging tool in the field
- All GPIO operations must use `try/finally` to ensure pins are properly cleaned up on script exit

---

### Sensor & Data Integrity Rules

- Water level data is always calculated and transmitted in **centimeters (cm)**
- Frame uploads must include: `sensor_id`, `timestamp` (ISO 8601), and the image as `multipart/form-data`
- Water level payloads must include: `sensor_id`, `water_level_cm`, `timestamp` (ISO 8601)
- The `sensor_id` value must match the ID registered in the backend's `device_health` table ‚Äî the backend uses this to update `last_seen`
- If the ultrasonic sensor returns an out-of-range or erratic reading (e.g., > 400 cm or negative), discard the reading and log a warning ‚Äî **do not transmit bad data**

---

### Connectivity Rules

- Support both **WiFi** (RPi built-in) and **4G SIM module** ‚Äî WiFi is primary, 4G is fallback
- If a transmission fails due to a network error, log the failure with timestamp and retry on the **next scheduled cycle** ‚Äî do not implement complex retry queues
- All HTTPS requests must have a **timeout of 10 seconds** ‚Äî do not allow hanging connections to block the main sensing loop

---

### What NOT to Do

- ‚ùå Do not run YOLOv8, OpenCV inference, or any ML model on the Pi Zero ‚Äî it belongs in `agos-backend`
- ‚ùå Do not implement a local database or file-based queue for unsent sensor data
- ‚ùå Do not increase the camera capture rate above 1 FPS
- ‚ùå Do not use the legacy `picamera` library ‚Äî use `Picamera2` only
- ‚ùå Do not hardcode the backend URL, sensor IDs, or any credentials
- ‚ùå Do not implement authentication logic ‚Äî JWT and user management belong in `agos-backend`
- ‚ùå Do not transmit erratic or out-of-range ultrasonic readings to the backend

---

_AGOS ‚Äî Shifting flood management from reactive response to proactive, data-driven prevention._
